<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Security Report - Security Reports</title>

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/responsive.css">

    <style>
        .submit-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1.5rem;
        }

        .submit-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .submit-header h1 {
            font-size: 2rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .submit-header p {
            color: var(--text-secondary);
        }

        .form-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .form-label.required::after {
            content: ' *';
            color: var(--accent-red);
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.95rem;
            font-family: inherit;
            transition: border-color 0.2s;
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }

        .form-help {
            font-size: 0.85rem;
            color: var(--text-tertiary);
            margin-top: 0.25rem;
        }

        .tag-input-container {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .tag-chip {
            padding: 0.25rem 0.75rem;
            background: var(--accent-primary);
            color: white;
            border-radius: 12px;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tag-remove {
            cursor: pointer;
            font-weight: bold;
        }

        .tag-remove:hover {
            opacity: 0.7;
        }

        .file-upload-zone {
            border: 2px dashed var(--border-color);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .file-upload-zone:hover {
            border-color: var(--accent-primary);
            background: var(--bg-tertiary);
        }

        .file-upload-zone.has-file {
            border-color: var(--accent-primary);
            background: rgba(var(--accent-primary-rgb), 0.1);
        }

        .file-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }

        .btn-primary {
            padding: 0.75rem 2rem;
            background: var(--accent-primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary:hover {
            background: var(--accent-primary-hover);
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            padding: 0.75rem 2rem;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            border-color: var(--accent-primary);
        }

        .form-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .info-box {
            background: var(--bg-tertiary);
            border-left: 4px solid var(--accent-primary);
            padding: 1rem 1.5rem;
            border-radius: 4px;
            margin-bottom: 2rem;
        }

        .info-box h3 {
            margin: 0 0 0.5rem 0;
            color: var(--text-primary);
        }

        .info-box ol {
            margin: 0;
            padding-left: 1.5rem;
        }

        .info-box li {
            color: var(--text-secondary);
            margin: 0.5rem 0;
        }

        @media (max-width: 768px) {
            .form-actions {
                flex-direction: column;
            }

            .btn-primary,
            .btn-secondary {
                width: 100%;
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <span class="logo-icon">ğŸ›¡ï¸</span>
                <div class="logo-text">
                    <h1 data-i18n="siteTitle">Security Reports</h1>
                    <p data-i18n="siteSubtitle">AI ê¸°ë°˜ ë³´ì•ˆ ìŠ¤ìº” ë¦¬í¬íŠ¸</p>
                </div>
            </div>

            <div class="header-actions">
                <button id="langToggle" class="btn" title="Change Language">
                    <span>ğŸŒ</span>
                    <span class="btn-text">KO</span>
                </button>

                <button id="themeToggle" class="btn" title="Toggle Theme">
                    <span class="theme-icon">ğŸŒ™</span>
                    <span class="btn-text" data-i18n="btnDark">ë‹¤í¬</span>
                </button>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="nav-tabs">
        <div class="nav-container">
            <a href="index.html" class="nav-tab" data-i18n="navHome">í™ˆ</a>
            <a href="blog.html" class="nav-tab" data-i18n="tabBlog">ë¸”ë¡œê·¸</a>
            <a href="reports.html" class="nav-tab" data-i18n="navReports">ë¦¬í¬íŠ¸</a>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="submit-container">
        <div class="submit-header">
            <h1 data-i18n="submitTitle">ğŸ“ ë³´ì•ˆ ë¦¬í¬íŠ¸ ê³µìœ í•˜ê¸°</h1>
            <p data-i18n="submitSubtitle">ì»¤ë®¤ë‹ˆí‹°ì— ë³´ì•ˆ ìŠ¤ìº” ê²°ê³¼ë¥¼ ê³µìœ í•´ì£¼ì„¸ìš”</p>
        </div>

        <!-- Info Box -->
        <div class="info-box">
            <h3 data-i18n="howItWorks">ğŸ“‹ ì‘ë™ ë°©ì‹</h3>
            <ol>
                <li data-i18n="howItWorksStep1">ì•„ë˜ ì–‘ì‹ì„ ì‘ì„±í•˜ì„¸ìš”</li>
                <li data-i18n="howItWorksStep2">JSON ë³´ì•ˆ ìŠ¤ìº” ë¦¬í¬íŠ¸ë¥¼ ì—…ë¡œë“œí•˜ì„¸ìš”</li>
                <li data-i18n="howItWorksStep3">ìƒì„±ëœ íŒŒì¼(ZIP)ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”</li>
                <li data-i18n="howItWorksStep4">GitHub Pull Requestë¡œ ì œì¶œí•˜ì„¸ìš”</li>
            </ol>
        </div>

        <!-- Form -->
        <form id="submitForm" class="form-card">
            <!-- Title -->
            <div class="form-group">
                <label class="form-label required" for="title" data-i18n="formTitle">ì œëª©</label>
                <input type="text" id="title" class="form-input" data-i18n-placeholder="formTitlePlaceholder"
                    placeholder="ì˜ˆ: React ì• í”Œë¦¬ì¼€ì´ì…˜ ë³´ì•ˆ ê°ì‚¬" required>
                <div class="form-help" data-i18n="formTitleHelp">ë³´ì•ˆ ë¦¬í¬íŠ¸ë¥¼ ëª…í™•í•˜ê²Œ ì„¤ëª…í•˜ëŠ” ì œëª©</div>
            </div>

            <!-- Description -->
            <div class="form-group">
                <label class="form-label required" for="description" data-i18n="formDescription">ì„¤ëª…</label>
                <textarea id="description" class="form-textarea" data-i18n-placeholder="formDescriptionPlaceholder"
                    placeholder="ë°œê²¬ëœ ë‚´ìš©ì— ëŒ€í•œ ê°„ëµí•œ ìš”ì•½..." required></textarea>
                <div class="form-help" data-i18n="formDescriptionHelp">ì§§ì€ ìš”ì•½ (1-2ë¬¸ì¥)</div>
            </div>

            <!-- Author -->
            <div class="form-group">
                <label class="form-label required" for="author" data-i18n="formAuthor">ì‘ì„±ì</label>
                <input type="text" id="author" class="form-input" data-i18n-placeholder="formAuthorPlaceholder"
                    placeholder="ì˜ˆ: ë³´ì•ˆ ì—°êµ¬íŒ€" required>
            </div>

            <!-- Tags -->
            <div class="form-group">
                <label class="form-label required" data-i18n="formTags">íƒœê·¸</label>
                <div class="tag-input-container" id="tagContainer">
                    <input type="text" id="tagInput" class="form-input" data-i18n-placeholder="formTagPlaceholder"
                        placeholder="íƒœê·¸ë¥¼ ì…ë ¥í•˜ê³  Enterë¥¼ ëˆ„ë¥´ì„¸ìš”" style="flex: 1; min-width: 200px;">
                </div>
                <div class="form-help" data-i18n="formTagHelp">íƒœê·¸ ì¶”ê°€ ì˜ˆ: security, react, critical, sql-injection (Enterë¡œ
                    ì¶”ê°€)</div>
            </div>

            <!-- Content -->
            <div class="form-group">
                <label class="form-label required" for="content" data-i18n="formContent">ìƒì„¸ ë¦¬í¬íŠ¸</label>
                <textarea id="content" class="form-textarea" style="min-height: 300px;"
                    data-i18n-placeholder="formContentPlaceholder"
                    placeholder="# ìƒì„¸ ë¶„ì„&#10;&#10;## ì£¼ìš” ë°œê²¬ì‚¬í•­&#10;&#10;### 1. ì‹¬ê°í•œ ì·¨ì•½ì &#10;&#10;..." required></textarea>
                <div class="form-help" data-i18n="formContentHelp">Markdown ì§€ì› - ìƒì„¸ ë¶„ì„, ë°œê²¬ì‚¬í•­, ê¶Œì¥ì‚¬í•­</div>
            </div>

            <!-- JSON File Upload -->
            <div class="form-group">
                <label class="form-label required" data-i18n="formJsonFile">JSON ë³´ì•ˆ ë¦¬í¬íŠ¸</label>
                <div class="file-upload-zone" id="uploadZone">
                    <div class="file-icon">ğŸ“„</div>
                    <div><strong data-i18n="formJsonFileUpload">í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ</strong> <span
                            data-i18n="formJsonFileDragDrop">ë˜ëŠ” ë“œë˜ê·¸ ì•¤ ë“œë¡­</span></div>
                    <div class="form-help" data-i18n="formJsonFileHelp">ë³´ì•ˆ ìŠ¤ìº”ì—ì„œ ìƒì„±ëœ JSON íŒŒì¼</div>
                </div>
                <input type="file" id="jsonFile" accept=".json" style="display: none;" required>
            </div>

            <!-- Actions -->
            <div class="form-actions">
                <button type="button" class="btn-secondary" onclick="window.location.href='blog.html'"
                    data-i18n="btnCancel">
                    ì·¨ì†Œ
                </button>
                <button type="submit" class="btn-primary" id="submitBtn">
                    <span data-i18n="btnGenerate">íŒŒì¼ ìƒì„±</span> ğŸ“¦
                </button>
            </div>
        </form>
    </div>

    <!-- Scripts -->
    <script src="js/i18n.js"></script>
    <script src="js/theme.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script>
        // Initialize i18n
        document.addEventListener('DOMContentLoaded', () => {
            if (window.i18n) {
                window.i18n.updatePageLanguage();
            }
        });

        // Tags management
        const tags = [];
        const tagInput = document.getElementById('tagInput');
        const tagContainer = document.getElementById('tagContainer');

        tagInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                const tag = tagInput.value.trim().toLowerCase();
                if (tag && !tags.includes(tag)) {
                    tags.push(tag);
                    renderTags();
                    tagInput.value = '';
                }
            }
        });

        function renderTags() {
            const existing = tagContainer.querySelectorAll('.tag-chip');
            existing.forEach(el => el.remove());

            tags.forEach(tag => {
                const chip = document.createElement('div');
                chip.className = 'tag-chip';
                chip.innerHTML = `
                    ${tag}
                    <span class="tag-remove" onclick="removeTag('${tag}')">Ã—</span>
                `;
                tagContainer.insertBefore(chip, tagInput);
            });
        }

        function removeTag(tag) {
            const index = tags.indexOf(tag);
            if (index > -1) {
                tags.splice(index, 1);
                renderTags();
            }
        }

        // File upload
        const uploadZone = document.getElementById('uploadZone');
        const jsonFile = document.getElementById('jsonFile');
        let selectedFile = null;

        uploadZone.addEventListener('click', () => jsonFile.click());

        jsonFile.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                selectedFile = e.target.files[0];
                uploadZone.classList.add('has-file');
                uploadZone.innerHTML = `
                    <div class="file-icon">âœ…</div>
                    <div><strong>${selectedFile.name}</strong></div>
                    <div class="form-help">${(selectedFile.size / 1024).toFixed(2)} KB</div>
                `;
            }
        });

        // Drag and drop
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            uploadZone.addEventListener(eventName, (e) => {
                e.preventDefault();
                e.stopPropagation();
            });
        });

        uploadZone.addEventListener('drop', (e) => {
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].name.endsWith('.json')) {
                jsonFile.files = files;
                selectedFile = files[0];
                uploadZone.classList.add('has-file');
                uploadZone.innerHTML = `
                    <div class="file-icon">âœ…</div>
                    <div><strong>${selectedFile.name}</strong></div>
                    <div class="form-help">${(selectedFile.size / 1024).toFixed(2)} KB</div>
                `;
            }
        });

        // Form submission
        document.getElementById('submitForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const t = window.i18n?.translations[window.i18n?.currentLanguage] || {};

            if (tags.length === 0) {
                alert(t.alertNoTags || 'ìµœì†Œ í•˜ë‚˜ì˜ íƒœê·¸ë¥¼ ì¶”ê°€í•´ì£¼ì„¸ìš”');
                return;
            }

            if (!selectedFile) {
                alert(t.alertNoFile || 'JSON íŒŒì¼ì„ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”');
                return;
            }

            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.querySelector('span').textContent = t.btnGenerating || 'ìƒì„± ì¤‘...';

            try {
                // Get form data
                const title = document.getElementById('title').value;
                const description = document.getElementById('description').value;
                const author = document.getElementById('author').value;
                const content = document.getElementById('content').value;

                // Generate post ID
                const postId = `post-${Date.now()}`;
                const date = new Date().toISOString().split('T')[0];

                // Create MD file content with frontmatter
                const mdContent = `---
id: ${postId}
title: "${title}"
author: "${author}"
date: "${date}"
tags: [${tags.map(t => `"${t}"`).join(', ')}]
description: "${description}"
jsonFile: "report.json"
---

${content}
`;

                // Read JSON file
                const jsonContent = await selectedFile.text();

                // Create ZIP file
                const zip = new JSZip();
                const folder = zip.folder(postId);
                folder.file('post.md', mdContent);
                folder.file('report.json', jsonContent);

                // Generate ZIP
                const blob = await zip.generateAsync({ type: 'blob' });

                // Download ZIP
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${postId}.zip`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                // Show success message
                const successMsg = t.alertSuccess || 'íŒŒì¼ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!';
                const nextSteps = t.alertNextSteps || 'ë‹¤ìŒ ë‹¨ê³„';
                alert(`âœ… ${successMsg}

${nextSteps}:
1. ${postId}.zip ì••ì¶• í•´ì œ
2. https://github.com/bosong2/securityreports Fork
3. /upload/${postId}/ í´ë”ì— ì—…ë¡œë“œ
4. Pull Request ìƒì„±
5. ìŠ¹ì¸ ëŒ€ê¸°

ê°ì‚¬í•©ë‹ˆë‹¤! ğŸ‰`);

                // Reset form
                document.getElementById('submitForm').reset();
                tags.length = 0;
                renderTags();
                selectedFile = null;
                uploadZone.classList.remove('has-file');

                const uploadText = t.formJsonFileUpload || 'í´ë¦­í•˜ì—¬ ì—…ë¡œë“œ';
                const dragText = t.formJsonFileDragDrop || 'ë˜ëŠ” ë“œë˜ê·¸ ì•¤ ë“œë¡­';
                const helpText = t.formJsonFileHelp || 'ë³´ì•ˆ ìŠ¤ìº”ì—ì„œ ìƒì„±ëœ JSON íŒŒì¼';

                uploadZone.innerHTML = `
                    <div class="file-icon">ğŸ“„</div>
                    <div><strong data-i18n="formJsonFileUpload">${uploadText}</strong> <span data-i18n="formJsonFileDragDrop">${dragText}</span></div>
                    <div class="form-help" data-i18n="formJsonFileHelp">${helpText}</div>
                `;

            } catch (error) {
                console.error('Error:', error);
                const errorMsg = t.alertError || 'íŒŒì¼ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
                alert(`âŒ ${errorMsg}`);
            } finally {
                submitBtn.disabled = false;
                submitBtn.querySelector('span').textContent = t.btnGenerate || 'íŒŒì¼ ìƒì„±';
            }
        });
    </script>
</body>

</html>